<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jardín Mágico para Mamá</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Comic Sans MS', cursive, sans-serif;
            background: linear-gradient(to bottom, #87CEEB, #E0F7FA);
            min-height: 100vh;
            overflow: hidden;
            touch-action: manipulation;
        }
        
        .garden-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        
        .message-board {
            background-color: rgba(255, 255, 255, 0.9);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            text-align: center;
            margin-bottom: 30px;
            max-width: 80%;
            z-index: 10;
        }
        
        h1 {
            color: #E91E63;
            margin-bottom: 10px;
            font-size: 2.2rem;
        }
        
        p {
            color: #4A148C;
            font-size: 1.2rem;
        }
        
        .flower-counter {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: rgba(255, 255, 255, 0.8);
            padding: 10px 15px;
            border-radius: 20px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
            font-size: 1.2rem;
            z-index: 100;
            display: flex;
            align-items: center;
        }
        
        .flower {
            position: absolute;
            cursor: pointer;
            transition: transform 0.3s;
            z-index: 5;
        }
        
        .flower:hover {
            transform: scale(1.1);
        }
        
        .controls {
            position: fixed;
            bottom: 30px;
            display: flex;
            gap: 15px;
            z-index: 10;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .btn {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 30px;
            font-size: 1.1rem;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
        }
        
        .btn:active {
            transform: translateY(1px);
        }
        
        .btn-special {
            background: linear-gradient(45deg, #FF4081, #E91E63);
        }
        
        .btn-music {
            background: linear-gradient(45deg, #2196F3, #3F51B5);
        }
        
        .btn-letter {
            background: linear-gradient(45deg, #FF9800, #FF5722);
        }
        
        .btn-share {
            background: linear-gradient(45deg, #9C27B0, #673AB7);
        }
        
        .butterfly {
            position: absolute;
            z-index: 4;
            font-size: 1.8rem;
            animation: fly linear infinite;
            opacity: 0.8;
        }
        
        .rainbow {
            position: absolute;
            width: 200%;
            height: 100px;
            top: 20%;
            left: -50%;
            background: linear-gradient( to right, rgba(255, 0, 0, 0.2), rgba(255, 165, 0, 0.2), rgba(255, 255, 0, 0.2), rgba(0, 255, 0, 0.2), rgba(0, 0, 255, 0.2), rgba(75, 0, 130, 0.2), rgba(238, 130, 238, 0.2));
            border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
            transform: rotate(-5deg);
            z-index: 1;
            display: none;
        }
        
        .music-control {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.8);
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            z-index: 100;
        }
        
        .music-control i {
            font-size: 1.5rem;
            color: #2196F3;
        }
        /* Modal de carta */
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background-color: #fff;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
            position: relative;
        }
        
        .close-modal {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 1.5rem;
            cursor: pointer;
            color: #888;
        }
        
        .letter-editor {
            width: 100%;
            min-height: 200px;
            margin: 20px 0;
            padding: 15px;
            border: 2px dashed #E91E63;
            border-radius: 10px;
            font-family: 'Comic Sans MS', cursive, sans-serif;
            font-size: 1.1rem;
            resize: none;
        }
        
        .modal-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }
        /* Modal de compartir */
        
        .share-options {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin-top: 20px;
        }
        
        .share-btn {
            padding: 10px 15px;
            border-radius: 50px;
            color: white;
            display: flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
            font-size: 1rem;
            transition: transform 0.3s;
        }
        
        .share-btn:hover {
            transform: translateY(-3px);
        }
        
        .whatsapp {
            background-color: #25D366;
        }
        
        .facebook {
            background-color: #3b5998;
        }
        
        .twitter {
            background-color: #1DA1F2;
        }
        
        .copy-link {
            background-color: #9C27B0;
        }
        
        @keyframes fly {
            0% {
                transform: translate(0, 0) rotate(0deg);
            }
            25% {
                transform: translate(50px, -30px) rotate(10deg);
            }
            50% {
                transform: translate(100px, 0) rotate(0deg);
            }
            75% {
                transform: translate(50px, 30px) rotate(-10deg);
            }
            100% {
                transform: translate(0, 0) rotate(0deg);
            }
        }
        
        @keyframes float {
            0%,
            100% {
                transform: rotate(-5deg) translateY(0);
            }
            50% {
                transform: rotate(-5deg) translateY(-20px);
            }
        }
        
        @media (max-width: 768px) {
            h1 {
                font-size: 1.8rem;
            }
            p {
                font-size: 1rem;
            }
            .controls {
                bottom: 15px;
                gap: 10px;
            }
            .btn {
                padding: 10px 20px;
                font-size: 1rem;
            }
            .flower-counter {
                top: 10px;
                right: 10px;
                font-size: 1rem;
                padding: 8px 12px;
            }
            .music-control {
                top: 10px;
                left: 10px;
                width: 40px;
                height: 40px;
            }
            .modal-content {
                padding: 20px;
                width: 95%;
            }
            .letter-editor {
                min-height: 150px;
            }
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>

<body>
    <div class="garden-container">
        <div class="flower-counter" id="counter">
            <i class="fas fa-seedling"></i> <span id="flowerCount">0</span>
        </div>

        <div class="music-control" id="musicControl">
            <i class="fas fa-music"></i>
        </div>

        <div class="rainbow" id="rainbow"></div>

        <div class="message-board">
            <h1>¡Crea un Jardín Mágico para Mamá!</h1>
            <p>Toca la pantalla para plantar flores. ¡Haz un regalo especial para ella!</p>
        </div>

        <div class="controls">
            <button class="btn" id="changeFlowerBtn">
                <i class="fas fa-exchange-alt"></i> Cambiar Flor
            </button>
            <button class="btn btn-special" id="specialEffectBtn">
                <i class="fas fa-magic"></i> ¡Sorpresa!
            </button>
            <button class="btn btn-music" id="musicBtn">
                <i class="fas fa-music"></i> Música
            </button>
            <button class="btn btn-letter" id="letterBtn">
                <i class="fas fa-envelope"></i> Escribir Carta
            </button>
            <button class="btn btn-share" id="shareBtn">
                <i class="fas fa-share-alt"></i> Compartir
            </button>
        </div>
    </div>

    <!-- Modal de carta -->
    <div class="modal" id="letterModal">
        <div class="modal-content">
            <span class="close-modal" id="closeLetterModal">&times;</span>
            <h2>Escribe una carta para mamá</h2>
            <textarea class="letter-editor" id="letterEditor" placeholder="Querida mamá..."></textarea>
            <div class="modal-buttons">
                <button class="btn btn-letter" id="saveLetterBtn">
                    <i class="fas fa-save"></i> Guardar Carta
                </button>
                <button class="btn" id="clearLetterBtn">
                    <i class="fas fa-trash"></i> Limpiar
                </button>
            </div>
        </div>
    </div>

    <!-- Modal de compartir -->
    <div class="modal" id="shareModal">
        <div class="modal-content">
            <span class="close-modal" id="closeShareModal">&times;</span>
            <h2>Comparte tu jardín con mamá</h2>
            <p>Guarda una imagen de tu creación o compártela directamente:</p>

            <div class="share-options">
                <a href="#" class="share-btn whatsapp" id="whatsappShare">
                    <i class="fab fa-whatsapp"></i> WhatsApp
                </a>
                <a href="#" class="share-btn facebook" id="facebookShare">
                    <i class="fab fa-facebook-f"></i> Facebook
                </a>
                <a href="#" class="share-btn twitter" id="twitterShare">
                    <i class="fab fa-twitter"></i> Twitter
                </a>
                <a href="#" class="share-btn copy-link" id="copyLinkBtn">
                    <i class="fas fa-copy"></i> Copiar Enlace
                </a>
            </div>

            <p style="margin-top: 20px;">O guarda una imagen de tu jardín:</p>
            <button class="btn" id="saveImageBtn" style="margin: 10px auto;">
                <i class="fas fa-camera"></i> Guardar Imagen
            </button>
        </div>
    </div>

    <audio id="backgroundMusic" loop>
        <source src="mama.mp3" type="audio/mpeg">
        <!-- Reemplaza con tu canción favorita -->
    </audio>

    <!-- HTML2Canvas para capturar pantalla -->
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>

    <script>
        // Tipos de flores disponibles (emojis)
        const flowerTypes = ['🌹', '🌸', '🌺', '🌻', '🌼', '🌷', '💐', '🏵️'];
        let currentFlowerType = 0;
        let flowerCount = 0;
        let garden = [];
        let butterflies = [];
        let isMusicPlaying = false;
        let isRainbowVisible = false;
        let savedLetter = "";

        // Elementos del DOM
        const counter = document.getElementById('counter');
        const flowerCountSpan = document.getElementById('flowerCount');
        const changeFlowerBtn = document.getElementById('changeFlowerBtn');
        const specialEffectBtn = document.getElementById('specialEffectBtn');
        const musicBtn = document.getElementById('musicBtn');
        const rainbowBtn = document.getElementById('rainbowBtn');
        const letterBtn = document.getElementById('letterBtn');
        const shareBtn = document.getElementById('shareBtn');
        const musicControl = document.getElementById('musicControl');
        const backgroundMusic = document.getElementById('backgroundMusic');
        const rainbow = document.getElementById('rainbow');
        const gardenContainer = document.querySelector('.garden-container');

        // Elementos del modal de carta
        const letterModal = document.getElementById('letterModal');
        const letterEditor = document.getElementById('letterEditor');
        const saveLetterBtn = document.getElementById('saveLetterBtn');
        const clearLetterBtn = document.getElementById('clearLetterBtn');
        const closeLetterModal = document.getElementById('closeLetterModal');

        // Elementos del modal de compartir
        const shareModal = document.getElementById('shareModal');
        const whatsappShare = document.getElementById('whatsappShare');
        const facebookShare = document.getElementById('facebookShare');
        const twitterShare = document.getElementById('twitterShare');
        const copyLinkBtn = document.getElementById('copyLinkBtn');
        const saveImageBtn = document.getElementById('saveImageBtn');
        const closeShareModal = document.getElementById('closeShareModal');

        // Inicialización
        function init() {
            createButterflies(5);
            updateFlowerButton();
            setupEventListeners();
            tryAutoPlayMusic();
            loadSavedLetter();
        }

        // Crear mariposas
        function createButterflies(count) {
            for (let i = 0; i < count; i++) {
                setTimeout(() => {
                    const butterfly = document.createElement('div');
                    butterfly.className = 'butterfly';
                    butterfly.innerHTML = '🦋';

                    // Posición y estilo aleatorio
                    butterfly.style.left = `${Math.random() * 100}vw`;
                    butterfly.style.top = `${Math.random() * 100}vh`;
                    butterfly.style.fontSize = `${Math.random() * 20 + 20}px`;
                    butterfly.style.color = `hsl(${Math.random() * 360}, 80%, 60%)`;

                    // Animación personalizada
                    const duration = Math.random() * 15 + 10;
                    butterfly.style.animationDuration = `${duration}s`;

                    gardenContainer.appendChild(butterfly);
                    butterflies.push(butterfly);
                }, i * 500);
            }
        }

        // Configurar event listeners
        function setupEventListeners() {
            // Cambiar tipo de flor
            changeFlowerBtn.addEventListener('click', changeFlowerType);

            // Plantar flores al hacer clic/tocar
            gardenContainer.addEventListener('click', plantFlower);

            // Plantar flores al arrastrar (para móviles)
            gardenContainer.addEventListener('touchmove', handleTouchMove, {
                passive: false
            });

            // Efecto especial
            specialEffectBtn.addEventListener('click', specialEffect);

            // Control de música
            musicBtn.addEventListener('click', toggleMusic);
            musicControl.addEventListener('click', toggleMusic);

            // Control de carta
            letterBtn.addEventListener('click', () => letterModal.style.display = 'flex');
            saveLetterBtn.addEventListener('click', saveLetter);
            clearLetterBtn.addEventListener('click', clearLetter);
            closeLetterModal.addEventListener('click', () => letterModal.style.display = 'none');

            // Control de compartir
            shareBtn.addEventListener('click', () => shareModal.style.display = 'flex');
            closeShareModal.addEventListener('click', () => shareModal.style.display = 'none');
            whatsappShare.addEventListener('click', shareOnWhatsApp);
            facebookShare.addEventListener('click', shareOnFacebook);
            twitterShare.addEventListener('click', shareOnTwitter);
            copyLinkBtn.addEventListener('click', copyLink);
            saveImageBtn.addEventListener('click', saveAsImage);
        }

        // Cambiar tipo de flor
        function changeFlowerType() {
            currentFlowerType = (currentFlowerType + 1) % flowerTypes.length;
            updateFlowerButton();
        }

        function updateFlowerButton() {
            changeFlowerBtn.innerHTML = `<i class="fas fa-exchange-alt"></i> Flor: ${flowerTypes[currentFlowerType]}`;
        }

        // Manejar movimiento táctil
        function handleTouchMove(e) {
            e.preventDefault();
            const touch = e.touches[0];
            plantFlower({
                clientX: touch.clientX,
                clientY: touch.clientY
            });
        }

        // Plantar una flor
        function plantFlower(e) {
            if (e.target.classList.contains('flower') ||
                e.target.classList.contains('btn') ||
                e.target.closest('.btn')) return;

            const x = e.clientX;
            const y = e.clientY;

            createFlower(x, y);
        }

        // Crear una nueva flor
        function createFlower(x, y) {
            const flower = document.createElement('div');
            flower.className = 'flower';
            flower.innerHTML = flowerTypes[currentFlowerType];
            flower.style.left = `${x - 20}px`;
            flower.style.top = `${y - 20}px`;
            flower.style.fontSize = `${Math.random() * 20 + 20}px`;

            // Rotación aleatoria
            flower.style.transform = `rotate(${Math.random() * 360}deg)`;

            // Color aleatorio para algunas flores
            if (Math.random() > 0.7) {
                const colors = ['#FF4081', '#E91E63', '#9C27B0', '#3F51B5', '#2196F3', '#4CAF50'];
                flower.style.color = colors[Math.floor(Math.random() * colors.length)];
            }

            // Animación de aparición
            flower.style.animation = 'grow 0.5s ease-out';

            // Guardar posición en el jardín
            garden.push({
                type: currentFlowerType,
                x: x,
                y: y,
                size: parseFloat(flower.style.fontSize),
                color: flower.style.color || '#000000'
            });

            // Agregar al contenedor
            gardenContainer.appendChild(flower);

            // Actualizar contador
            flowerCount++;
            flowerCountSpan.textContent = flowerCount;

            // Eliminar el evento de animación después de que termine
            setTimeout(() => {
                flower.style.animation = '';
            }, 500);

            // Efecto al hacer clic en una flor
            flower.addEventListener('click', (e) => {
                e.stopPropagation();
                makeFlowerDance(flower);
            });
        }

        // Hacer bailar una flor
        function makeFlowerDance(flower) {
            flower.style.transition = 'all 0.3s';
            flower.style.transform = `scale(1.3) rotate(${Math.random() * 360}deg)`;

            setTimeout(() => {
                flower.style.transform = `scale(1) rotate(${Math.random() * 360}deg)`;
            }, 300);
        }

        // Efecto especial
        function specialEffect() {
            // Crear muchas flores aleatorias
            for (let i = 0; i < 20; i++) {
                setTimeout(() => {
                    const x = Math.random() * window.innerWidth;
                    const y = Math.random() * window.innerHeight;
                    createFlower(x, y);
                }, i * 100);
            }

            // Crear mariposas adicionales
            createButterflies(3);

            // Mostrar arcoíris
            showRainbow();

            // Mostrar mensaje especial
            const specialMessage = document.createElement('div');
            specialMessage.textContent = '¡Te quiero mucho, mamá! ❤️';
            specialMessage.style.position = 'fixed';
            specialMessage.style.top = '50%';
            specialMessage.style.left = '50%';
            specialMessage.style.transform = 'translate(-50%, -50%)';
            specialMessage.style.fontSize = '2.5rem';
            specialMessage.style.color = '#E91E63';
            specialMessage.style.backgroundColor = 'rgba(255, 255, 255, 0.9)';
            specialMessage.style.padding = '20px 40px';
            specialMessage.style.borderRadius = '20px';
            specialMessage.style.boxShadow = '0 5px 20px rgba(0, 0, 0, 0.2)';
            specialMessage.style.zIndex = '100';
            specialMessage.style.animation = 'pulse 1.5s infinite';

            gardenContainer.appendChild(specialMessage);

            // Eliminar mensaje después de 3 segundos
            setTimeout(() => {
                specialMessage.remove();
            }, 3000);
        }

        // Control de música
        function toggleMusic() {
            if (isMusicPlaying) {
                backgroundMusic.pause();
                musicControl.innerHTML = '<i class="fas fa-music"></i>';
                musicBtn.innerHTML = '<i class="fas fa-music"></i> Activar Música';
            } else {
                backgroundMusic.play()
                    .then(() => {
                        isMusicPlaying = true;
                        musicControl.innerHTML = '<i class="fas fa-pause"></i>';
                        musicBtn.innerHTML = '<i class="fas fa-pause"></i> Pausar Música';
                    })
                    .catch(error => {
                        console.log("Error al reproducir música:", error);
                        alert("Por favor haz clic en cualquier parte de la página para activar la música");
                    });
            }
        }

        // Intentar reproducción automática
        function tryAutoPlayMusic() {
            backgroundMusic.volume = 0.3;
            document.body.addEventListener('click', () => {
                backgroundMusic.play()
                    .then(() => {
                        isMusicPlaying = true;
                        musicControl.innerHTML = '<i class="fas fa-pause"></i>';
                        musicBtn.innerHTML = '<i class="fas fa-pause"></i> Pausar Música';
                    })
                    .catch(error => {
                        console.log("La reproducción automática fue bloqueada:", error);
                    });
            }, {
                once: true
            });
        }

        // Carta personalizada
        function saveLetter() {
            savedLetter = letterEditor.value;
            localStorage.setItem('mothersDayLetter', savedLetter);
            alert('Carta guardada correctamente');
            letterModal.style.display = 'none';
        }

        function clearLetter() {
            if (confirm('¿Estás seguro de que quieres borrar tu carta?')) {
                letterEditor.value = '';
                localStorage.removeItem('mothersDayLetter');
                savedLetter = '';
            }
        }

        function loadSavedLetter() {
            const saved = localStorage.getItem('mothersDayLetter');
            if (saved) {
                savedLetter = saved;
                letterEditor.value = saved;
            }
        }

        // Funciones para compartir
        function shareOnWhatsApp(e) {
            e.preventDefault();
            const text = "Mira el jardín especial que creé para el Día de la Madre: " + window.location.href;
            window.open(`https://wa.me/?text=${encodeURIComponent(text)}`, '_blank');
        }

        function shareOnFacebook(e) {
            e.preventDefault();
            window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(window.location.href)}`, '_blank');
        }

        function shareOnTwitter(e) {
            e.preventDefault();
            const text = "Mira el jardín especial que creé para el Día de la Madre";
            window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}&url=${encodeURIComponent(window.location.href)}`, '_blank');
        }

        function copyLink(e) {
            e.preventDefault();
            navigator.clipboard.writeText(window.location.href)
                .then(() => alert('Enlace copiado al portapapeles'))
                .catch(() => prompt('Copiar este enlace:', window.location.href));
        }

        function saveAsImage() {
            // Ocultar elementos temporales
            const tempElements = document.querySelectorAll('.flower-counter, .music-control, .controls');
            tempElements.forEach(el => el.style.visibility = 'hidden');

            // Capturar pantalla
            html2canvas(document.body).then(canvas => {
                // Mostrar elementos nuevamente
                tempElements.forEach(el => el.style.visibility = 'visible');

                // Crear enlace de descarga
                const link = document.createElement('a');
                link.download = 'jardin-para-mama.png';
                link.href = canvas.toDataURL('image/png');
                link.click();
            });

            shareModal.style.display = 'none';
        }

        // Animación CSS
        const style = document.createElement('style');
        style.textContent = `
            @keyframes grow {
                0% { transform: scale(0) rotate(0deg); opacity: 0; }
                80% { transform: scale(1.1) rotate(10deg); opacity: 1; }
                100% { transform: scale(1) rotate(0deg); opacity: 1; }
            }
            
            @keyframes pulse {
                0% { transform: translate(-50%, -50%) scale(1); }
                50% { transform: translate(-50%, -50%) scale(1.1); }
                100% { transform: translate(-50%, -50%) scale(1); }
            }
            
            @keyframes fly {
                0% {
                    transform: translate(0, 0) rotate(0deg);
                }
                25% {
                    transform: translate(50px, -30px) rotate(10deg);
                }
                50% {
                    transform: translate(100px, 0) rotate(0deg);
                }
                75% {
                    transform: translate(50px, 30px) rotate(-10deg);
                }
                100% {
                    transform: translate(0, 0) rotate(0deg);
                }
            }
            
            @keyframes float {
                0%, 100% {
                    transform: rotate(-5deg) translateY(0);
                }
                50% {
                    transform: rotate(-5deg) translateY(-20px);
                }
            }
        `;
        document.head.appendChild(style);

        // Inicializar la aplicación
        window.addEventListener('load', init);
    </script>
</body>

</html>